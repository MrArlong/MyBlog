<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>写文章</title>
  <link rel="stylesheet" href="../layui/css/layui.css" />
  <link rel="stylesheet" href="../css/article/article.css">
</head>
<script src="../vue/vue.js"></script>
<script src="../layui/layui.all.js"></script>
<script type="text/javascript" src="../js/wangEditor.js"></script>
<script src="../js/article/article.js"></script>



<body>
  <div class="layui_top">
    <div class="layui_top_01">
      <ul class="">
        <li class="layui_top_02"><a href="/">首页</a></li>
        <li class="layui_top_02 "><a href="">博客</a></li>
        <li class="layui_top_02"><a href="">模块</a></li>
        <li class="layui_top_02"><a href="">模块</a></li>
      </ul>
      <div class="layui-input-block layui_top_03">
        <button class="layui-btn layui-btn-normal layui_top_05">保存</button>
      </div>
    </div>
  </div>

  <div class="wangEditor3">
    <div class="wangEditor3_top_01"></div>
    <div id="wangEditor3_01" class="toolbar_01"></div>
    <div class="toolbar_03">
      <!-- 两个div之间的距离 -->
    </div>
    <div>
        <!--标题-->
      <textarea autofocus placeholder="输入标题..." cols="10" spellcheck="false" maxlength="80" rows="1"
        class="textarea_01"></textarea>
    </div>
        <!--正文-->
    <div id="wangEditor3_02" class="toolbar_02 w-e-text" contenteditable="true">
    </div>
      <div class="footer_01">
          <footer>
              <div>
                  备案信息：<a href="//www.beian.miit.gov.cn/">豫ICP备19034999号</a>
              </div>
          </footer>
      </div>

  </div>
  <!-- 注意， 只需要引用 JS，无需引用任何 CSS ！！！-->
  <script type="text/javascript">
    // 其他样式在article.js里面
    editor.create()
  </script>
  <script>
    layui.use(['layer', 'form', 'jquery', 'element'], function () {
      var layer = layui.layer,
        $ = layui.$,
        form = layui.form, //form表单
        upload = layui.upload, //图片文件上传
        element = layui.element,
        carousel = layui.carousel
      //轮播图
      carousel.render({
        elem: '#myblog_lb_01',
        width: '100%', //设置容器宽度
        arrow: 'always', //始终显示箭头
        anim: 'fade' //切换动画方式
      })
        //接收传值
        function getQueryString(name) {
            var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
            var r = window.location.search.substr(1).match(reg);
            if (r != null) {
                return unescape(r[2]);
            }
            return null;
        }
        //回显
        var id = getQueryString("myblogArticleId")
        if(id!==null&&id!=='') {
            $.ajax({
                url: '/index/queryArticle?myblogArticleId=' + id,
                type: 'post',
                dataType: 'json',
                success: function (res) {
                    $(".textarea_01").html(res.data[0].myblogArticleTitle);//标题
                    $(".toolbar_02").html(res.data[0].myblogArticleContents);//正文
                },
                error: function () {
                    layer.msg("网络异常");
                }
            });
        }
        //保存和更新
        var ind = getQueryString("myblogArticleId")
        $('body').on('click', '.layui_top_05', function (res) {
            var title=$(".textarea_01").val();
            var contents=$(".w-e-text").text();
            var contentshtml=$(".w-e-text").html();
            console.log(contents)
            $.ajax({
                url: '/index/AddOrUpdateArticleor',
                type: 'post',
                dataType: 'json',
                data: {
                    myblogArticleId:ind,
                    myblogArticleTitle:title,
                    myblogArticleContents:contents,
                    myblogArticleContentshtml:contentshtml
                },
                success: function (res) {
                     layer.msg(res.msg,{icon:7,time:1500},function () {
                         if(res.msg==='成功'){
                             window.location.href = '/'
                         }
                     });
                },
                error: function () {
                    layer.msg("网络异常");
                }
            });
        });
    })
  </script>
</body>

</html>